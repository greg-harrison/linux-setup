#!/bin/bash
# Shows your svn diff in vimdiff

function to_absolute() {
  if [[ "$1" = /* ]]; then
    echo $1
  else
    echo "$(pwd)/$1"
  fi
}

if [ $# -eq 0 ]; then
  ARG_FILES=`pwd`
else
  ARG_FILES="$(to_absolute $1)"
  shift
  for var in "$@"
  do
    ARG_FILES="$ARG_FILES\n$(to_absolute $var)"
  done
fi

FILES=$(echo -e $ARG_FILES | xargs svn status --ignore-externals | grep -P '^(A|M|D)' | cut -d' ' -f8-)

REVISION=$(svn info | grep Revision | awk '{print $2}')
vimdiff <(echo $FILES | xargs svn cat -r$REVISION) <(echo $FILES | xargs cat)
